{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [],
   "source": [
    "numeric_stats = ['derived_fg', 'derived_ft', 'G', 'GS', 'MP', 'FG', 'FGA', 'FG%', '3P', '3PA', '3P%', '2P', '2PA', '2P%', 'eFG%', 'FT', 'FTA', 'FT%', 'ORB', 'DRB', 'TRB', 'AST', 'STL', 'BLK', 'TOV', 'PF', 'PTS']\n",
    "fantasy_stats = ['d_FG%', 'd_FT%', 'FG%', 'FT%','TRB', 'AST', 'STL', 'BLK', 'TOV', '3P', 'PTS']\n",
    "negative_stats = ['FTA', 'TOV', 'FGA']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "import requests\n",
    "from bs4 import BeautifulSoup\n",
    "import pandas as pd\n",
    "\n",
    "url = 'https://www.basketball-reference.com/leagues/NBA_2021_totals.html'\n",
    "r = requests.get(url)\n",
    "r_html = r.text\n",
    "soup = BeautifulSoup(r_html,'html.parser')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [],
   "source": [
    "table=soup.find_all(class_=\"full_table\")\n",
    "    \n",
    "\"\"\" Extracting List of column names\"\"\"\n",
    "head=soup.find(class_=\"thead\")\n",
    "column_names_raw=[head.text for item in head][0]\n",
    "\n",
    "column_names_polished=column_names_raw.replace(\"\\n\",\",\").split(\",\")[2:-1]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [],
   "source": [
    "players=[]\n",
    "    \n",
    "for i in range(len(table)):    \n",
    "    player_=[]\n",
    "    for td in table[i].find_all(\"td\"):\n",
    "        val = td.text\n",
    "        try:\n",
    "            val = float(td.text)\n",
    "        except ValueError:\n",
    "            pass\n",
    "        player_.append(val)\n",
    "    players.append(player_)\n",
    "    \n",
    "player_stats=pd.DataFrame(players, columns=column_names_polished)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Player</th>\n",
       "      <th>G</th>\n",
       "      <th>MP</th>\n",
       "      <th>FG</th>\n",
       "      <th>FGA</th>\n",
       "      <th>3P</th>\n",
       "      <th>FT</th>\n",
       "      <th>FTA</th>\n",
       "      <th>ORB</th>\n",
       "      <th>DRB</th>\n",
       "      <th>...</th>\n",
       "      <th>AST</th>\n",
       "      <th>STL</th>\n",
       "      <th>BLK</th>\n",
       "      <th>TOV</th>\n",
       "      <th>PF</th>\n",
       "      <th>PTS</th>\n",
       "      <th>FT%</th>\n",
       "      <th>FG%</th>\n",
       "      <th>d_FG%</th>\n",
       "      <th>d_FT%</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Precious Achiuwa</td>\n",
       "      <td>19.0</td>\n",
       "      <td>303.0</td>\n",
       "      <td>57.0</td>\n",
       "      <td>89.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>29.0</td>\n",
       "      <td>53.0</td>\n",
       "      <td>33.0</td>\n",
       "      <td>59.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.842105</td>\n",
       "      <td>0.368421</td>\n",
       "      <td>0.578947</td>\n",
       "      <td>1.210526</td>\n",
       "      <td>41.0</td>\n",
       "      <td>7.526316</td>\n",
       "      <td>54.716981</td>\n",
       "      <td>64.044944</td>\n",
       "      <td>1175.646974</td>\n",
       "      <td>-555.242328</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Jaylen Adams</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>-0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Steven Adams</td>\n",
       "      <td>18.0</td>\n",
       "      <td>546.0</td>\n",
       "      <td>67.0</td>\n",
       "      <td>113.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>20.0</td>\n",
       "      <td>41.0</td>\n",
       "      <td>75.0</td>\n",
       "      <td>101.0</td>\n",
       "      <td>...</td>\n",
       "      <td>2.500000</td>\n",
       "      <td>0.944444</td>\n",
       "      <td>0.611111</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>34.0</td>\n",
       "      <td>8.555556</td>\n",
       "      <td>48.780488</td>\n",
       "      <td>59.292035</td>\n",
       "      <td>1063.455965</td>\n",
       "      <td>-501.655610</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Bam Adebayo</td>\n",
       "      <td>17.0</td>\n",
       "      <td>557.0</td>\n",
       "      <td>124.0</td>\n",
       "      <td>213.0</td>\n",
       "      <td>0.117647</td>\n",
       "      <td>89.0</td>\n",
       "      <td>103.0</td>\n",
       "      <td>30.0</td>\n",
       "      <td>129.0</td>\n",
       "      <td>...</td>\n",
       "      <td>5.470588</td>\n",
       "      <td>0.823529</td>\n",
       "      <td>0.823529</td>\n",
       "      <td>3.235294</td>\n",
       "      <td>40.0</td>\n",
       "      <td>19.941176</td>\n",
       "      <td>86.407767</td>\n",
       "      <td>58.215962</td>\n",
       "      <td>1834.754112</td>\n",
       "      <td>1116.460382</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>LaMarcus Aldridge</td>\n",
       "      <td>17.0</td>\n",
       "      <td>462.0</td>\n",
       "      <td>102.0</td>\n",
       "      <td>217.0</td>\n",
       "      <td>1.294118</td>\n",
       "      <td>16.0</td>\n",
       "      <td>21.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>...</td>\n",
       "      <td>2.058824</td>\n",
       "      <td>0.352941</td>\n",
       "      <td>0.882353</td>\n",
       "      <td>0.882353</td>\n",
       "      <td>27.0</td>\n",
       "      <td>14.235294</td>\n",
       "      <td>76.190476</td>\n",
       "      <td>47.004608</td>\n",
       "      <td>365.675098</td>\n",
       "      <td>37.235326</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>469</th>\n",
       "      <td>Delon Wright</td>\n",
       "      <td>20.0</td>\n",
       "      <td>542.0</td>\n",
       "      <td>62.0</td>\n",
       "      <td>147.0</td>\n",
       "      <td>0.900000</td>\n",
       "      <td>38.0</td>\n",
       "      <td>47.0</td>\n",
       "      <td>19.0</td>\n",
       "      <td>71.0</td>\n",
       "      <td>...</td>\n",
       "      <td>4.550000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.600000</td>\n",
       "      <td>1.050000</td>\n",
       "      <td>21.0</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>80.851064</td>\n",
       "      <td>42.176871</td>\n",
       "      <td>-77.046629</td>\n",
       "      <td>265.536229</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>470</th>\n",
       "      <td>Thaddeus Young</td>\n",
       "      <td>14.0</td>\n",
       "      <td>343.0</td>\n",
       "      <td>64.0</td>\n",
       "      <td>114.0</td>\n",
       "      <td>0.285714</td>\n",
       "      <td>10.0</td>\n",
       "      <td>19.0</td>\n",
       "      <td>31.0</td>\n",
       "      <td>42.0</td>\n",
       "      <td>...</td>\n",
       "      <td>4.142857</td>\n",
       "      <td>1.071429</td>\n",
       "      <td>0.357143</td>\n",
       "      <td>1.928571</td>\n",
       "      <td>37.0</td>\n",
       "      <td>10.142857</td>\n",
       "      <td>52.631579</td>\n",
       "      <td>56.140351</td>\n",
       "      <td>814.130724</td>\n",
       "      <td>-212.316894</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>471</th>\n",
       "      <td>Trae Young</td>\n",
       "      <td>18.0</td>\n",
       "      <td>614.0</td>\n",
       "      <td>137.0</td>\n",
       "      <td>326.0</td>\n",
       "      <td>2.333333</td>\n",
       "      <td>170.0</td>\n",
       "      <td>192.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>59.0</td>\n",
       "      <td>...</td>\n",
       "      <td>8.611111</td>\n",
       "      <td>0.666667</td>\n",
       "      <td>0.222222</td>\n",
       "      <td>4.055556</td>\n",
       "      <td>36.0</td>\n",
       "      <td>27.000000</td>\n",
       "      <td>88.541667</td>\n",
       "      <td>42.024540</td>\n",
       "      <td>-191.117525</td>\n",
       "      <td>2495.327719</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>472</th>\n",
       "      <td>Cody Zeller</td>\n",
       "      <td>7.0</td>\n",
       "      <td>152.0</td>\n",
       "      <td>23.0</td>\n",
       "      <td>50.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>9.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>38.0</td>\n",
       "      <td>...</td>\n",
       "      <td>2.428571</td>\n",
       "      <td>0.714286</td>\n",
       "      <td>0.571429</td>\n",
       "      <td>0.714286</td>\n",
       "      <td>14.0</td>\n",
       "      <td>7.857143</td>\n",
       "      <td>69.230769</td>\n",
       "      <td>46.000000</td>\n",
       "      <td>59.350159</td>\n",
       "      <td>-41.692492</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>473</th>\n",
       "      <td>Ivica Zubac</td>\n",
       "      <td>21.0</td>\n",
       "      <td>398.0</td>\n",
       "      <td>60.0</td>\n",
       "      <td>89.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>42.0</td>\n",
       "      <td>50.0</td>\n",
       "      <td>43.0</td>\n",
       "      <td>83.0</td>\n",
       "      <td>...</td>\n",
       "      <td>1.095238</td>\n",
       "      <td>0.380952</td>\n",
       "      <td>0.857143</td>\n",
       "      <td>0.904762</td>\n",
       "      <td>50.0</td>\n",
       "      <td>7.714286</td>\n",
       "      <td>84.000000</td>\n",
       "      <td>67.415730</td>\n",
       "      <td>1439.770322</td>\n",
       "      <td>425.742731</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>474 rows × 21 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                Player     G     MP     FG    FGA        3P     FT    FTA  \\\n",
       "0     Precious Achiuwa  19.0  303.0   57.0   89.0  0.000000   29.0   53.0   \n",
       "1         Jaylen Adams   1.0    1.0    0.0    1.0  0.000000    0.0    0.0   \n",
       "2         Steven Adams  18.0  546.0   67.0  113.0  0.000000   20.0   41.0   \n",
       "3          Bam Adebayo  17.0  557.0  124.0  213.0  0.117647   89.0  103.0   \n",
       "4    LaMarcus Aldridge  17.0  462.0  102.0  217.0  1.294118   16.0   21.0   \n",
       "..                 ...   ...    ...    ...    ...       ...    ...    ...   \n",
       "469       Delon Wright  20.0  542.0   62.0  147.0  0.900000   38.0   47.0   \n",
       "470     Thaddeus Young  14.0  343.0   64.0  114.0  0.285714   10.0   19.0   \n",
       "471         Trae Young  18.0  614.0  137.0  326.0  2.333333  170.0  192.0   \n",
       "472        Cody Zeller   7.0  152.0   23.0   50.0  0.000000    9.0   13.0   \n",
       "473        Ivica Zubac  21.0  398.0   60.0   89.0  0.000000   42.0   50.0   \n",
       "\n",
       "      ORB    DRB  ...       AST       STL       BLK       TOV    PF  \\\n",
       "0    33.0   59.0  ...  0.842105  0.368421  0.578947  1.210526  41.0   \n",
       "1     0.0    0.0  ...  0.000000  0.000000  0.000000  0.000000   0.0   \n",
       "2    75.0  101.0  ...  2.500000  0.944444  0.611111  2.000000  34.0   \n",
       "3    30.0  129.0  ...  5.470588  0.823529  0.823529  3.235294  40.0   \n",
       "4    15.0   62.0  ...  2.058824  0.352941  0.882353  0.882353  27.0   \n",
       "..    ...    ...  ...       ...       ...       ...       ...   ...   \n",
       "469  19.0   71.0  ...  4.550000  1.200000  0.600000  1.050000  21.0   \n",
       "470  31.0   42.0  ...  4.142857  1.071429  0.357143  1.928571  37.0   \n",
       "471  16.0   59.0  ...  8.611111  0.666667  0.222222  4.055556  36.0   \n",
       "472  18.0   38.0  ...  2.428571  0.714286  0.571429  0.714286  14.0   \n",
       "473  43.0   83.0  ...  1.095238  0.380952  0.857143  0.904762  50.0   \n",
       "\n",
       "           PTS        FT%        FG%        d_FG%        d_FT%  \n",
       "0     7.526316  54.716981  64.044944  1175.646974  -555.242328  \n",
       "1     0.000000        NaN   0.000000    -0.000000          NaN  \n",
       "2     8.555556  48.780488  59.292035  1063.455965  -501.655610  \n",
       "3    19.941176  86.407767  58.215962  1834.754112  1116.460382  \n",
       "4    14.235294  76.190476  47.004608   365.675098    37.235326  \n",
       "..         ...        ...        ...          ...          ...  \n",
       "469   9.000000  80.851064  42.176871   -77.046629   265.536229  \n",
       "470  10.142857  52.631579  56.140351   814.130724  -212.316894  \n",
       "471  27.000000  88.541667  42.024540  -191.117525  2495.327719  \n",
       "472   7.857143  69.230769  46.000000    59.350159   -41.692492  \n",
       "473   7.714286  84.000000  67.415730  1439.770322   425.742731  \n",
       "\n",
       "[474 rows x 21 columns]"
      ]
     },
     "execution_count": 35,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import unidecode\n",
    "\n",
    "def name_transform(name):\n",
    "    name = name.split('\\\\')[0].strip()\n",
    "    name = unidecode.unidecode(name)\n",
    "    transforms = {}\n",
    "    transforms['Marcus Morris'] = 'Marcus Morris Sr.'\n",
    "    transforms['Otto Porter'] = 'Otto Porter Jr.'\n",
    "    if name in transforms:\n",
    "        return transforms[name]\n",
    "    return name\n",
    "arr = player_stats\n",
    "arr['Player'] = arr['Player'].transform(name_transform)\n",
    "arr = arr.drop(['GS', 'Age', 'Pos', 'FG%', 'FT%', '2P%', 'eFG%', '3PA', '3P%', '2P', '2PA', 'Tm'], axis=1)\n",
    "# arr = arr.groupby(arr['Player']).sum()\n",
    "arr['FT%'] = arr['FT'] * 100 / arr['FTA']\n",
    "arr['FG%'] = arr['FG'] * 100 / arr['FGA']\n",
    "arr['d_FG%'] = arr['FG'] * (arr['FG%'] - arr['FG%'].mean())\n",
    "arr['d_FT%'] = arr['FT'] * (arr['FT%'] - arr['FT%'].mean())\n",
    "# # arr['TOV'] = -1 * arr['TOV']\n",
    "arr[['TRB', 'AST', 'STL', 'BLK', 'TOV', '3P', 'PTS']] = arr[['TRB', 'AST', 'STL', 'BLK', 'TOV', '3P', 'PTS']].div(arr['G'], axis=0)\n",
    "arr"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
